"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),l=require("../../config/global-config.js");if(require("../../network/request.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-auploadimg")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../components/uni-auploadimg/uni-auploadimg.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const d={__name:"chulanAdd",setup(d){const o=e.ref(),r=e.ref({name:e.index.getStorageSync("user").zname||"",dyid:"",qsid:"",qddd:"",dddd:"",cyr:"",dianhua:"",cph:"",picture:[],erbiao:""}),i=e.ref([]),n=e.ref([]);e.ref([]),e.ref([]);const u=e=>{r.value.picture=String(e),console.log(r.value.picture),console.log(String(r.value.picture))},t=e=>{m()},s=a=>{a||(console.log(a),e.index.showToast({title:"未找到该圈舍",icon:"none"})),v.value=[]},c=()=>{o.value.validate().then((async a=>{if(v.value.length<1)return e.index.showToast({title:"还没有选择耳标",icon:"none"});const l=v.value.map((e=>e.deernum||e.id)),d=v.value.map((e=>e.id));let o={qyid:e.index.getStorageSync("user").qyid,unitid:r.value.dyid,qsid:r.value.qsid,lunums:String(d),ebnums:String(l),sbnum:d.length,qdaddress:r.value.qddd,daaddress:r.value.dddd,carrier:r.value.cyr,phone:r.value.dianhua,carnum:r.value.cph,ticket:String(r.value.picture),declarant:e.index.getStorageSync("user").name};await e.index.$post("/addcljl",o),e.index.showToast({title:"出栏成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3)})).catch((e=>{}))};e.onShow((()=>{p(),e.index.getStorage({key:"selectAddress",success:a=>{v.value=a.data;const l=a.data.map((e=>e.deernum||e.id));r.value.erbiao=String(l),e.index.removeStorage({key:"selectAddress"})}})}));const p=async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const l=await e.index.$post("/unitlist",a);i.value=l.data.map((e=>({value:e.id,text:e.unitname})))},m=async()=>{n.value=[];let a={unitid:r.value.dyid};const l=await e.index.$post("/qslist",a);console.log("获取犬舍信息",l.data),n.value=l.data.map((e=>({value:e.id,text:e.enclosurename})))},v=e.ref([]),g=()=>{const a=r.value.qsid,l=r.value.dyid;console.log("耳标回显",v.value),a?e.index.navigateTo({url:`/pages/erbiao/erbiao?eb=${JSON.stringify(v.value)}&qsid=${a}&dyid=${l}`}):e.index.showToast({title:"选择圈舍后再操作",icon:"none"})};return(d,p)=>({a:e.o(t),b:e.o((e=>r.value.dyid=e)),c:e.p({localdata:i.value,placeholder:"请选择",modelValue:r.value.dyid}),d:e.p({label:"所在单元:",name:"dyid",required:!0}),e:e.o(s),f:e.o((e=>r.value.qsid=e)),g:e.p({localdata:n.value,placeholder:"请选择",modelValue:r.value.qsid}),h:e.o((a=>{return l="quanshe",void e.index.scanCode({success:async function(e){let a=JSON.parse(e.result);a&&"quanshe"==l&&(r.value.dyid=a.unitid,await m(),r.value.qsid=a.qsid,console.log("扫码圈舍",r.value.qsid))},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}});var l})),i:a._imports_0,j:e.p({label:"所在圈舍:",rules:[{required:!0,errorMessage:"请选择所在圈舍"}],name:"qsid",required:!0}),k:e.o(g),l:e.o((e=>r.value.erbiao=e)),m:e.p({type:"text",suffixIcon:"bottom",placeholder:"请选择鹿只耳标",disabled:!0,modelValue:r.value.erbiao}),n:e.p({label:"耳标编号:",name:"eb",required:!0}),o:e.o((e=>v.value.length=e)),p:e.p({type:"text",placeholder:"自动计算",disabled:"",modelValue:v.value.length}),q:e.p({label:"申报数量:",required:!0}),r:e.o((e=>r.value.qddd=e)),s:e.p({type:"text",placeholder:"请输入启动地点",modelValue:r.value.qddd}),t:e.p({label:"启动地点:",rules:[{required:!0,errorMessage:"请输入启动地点"}],name:"qddd",required:!0}),v:e.o((e=>r.value.dddd=e)),w:e.p({type:"text",placeholder:"请输入到达地点",modelValue:r.value.dddd}),x:e.p({label:"到达地点:",rules:[{required:!0,errorMessage:"请输入到达地点"}],name:"dddd",required:!0}),y:e.o((e=>r.value.cyr=e)),z:e.p({type:"text",placeholder:"请输入承运人",modelValue:r.value.cyr}),A:e.p({label:"承运人:",rules:[{required:!0,errorMessage:"请输入承运人"}],name:"cyr",required:!0}),B:e.o((e=>r.value.dianhua=e)),C:e.p({type:"text",placeholder:"请输入电话",modelValue:r.value.dianhua}),D:e.p({label:"电话:",rules:[{required:!0,errorMessage:"请输入电话"}],name:"dianhua",required:!0}),E:e.o((e=>r.value.cph=e)),F:e.p({type:"text",placeholder:"请输入车牌号",modelValue:r.value.cph}),G:e.p({label:"车牌号:",rules:[{required:!0,errorMessage:"请输入车牌号"}],name:"cph",required:!0}),H:e.p({label:"上传票证:",rules:[{required:!0,errorMessage:"请上传图片"}],name:"picture",required:!0}),I:e.o(u),J:e.p({action:e.unref(l.uploadUrl)}),K:e.sr(o,"2b33c1ee-0",{k:"form"}),L:e.p({modelValue:r.value,"label-width":"80px"}),M:e.o(c)})}};wx.createPage(d);
