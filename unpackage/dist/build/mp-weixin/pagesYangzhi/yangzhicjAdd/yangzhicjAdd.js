"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),n=require("../../config/global-config.js");if(require("../../network/request.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-auploadimg")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../components/uni-auploadimg/uni-auploadimg.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const i={__name:"yangzhicjAdd",setup(i){const o=e.ref(),t=e.ref({name:e.index.getStorageSync("user").zname||"",dyid:"",qsid:"",xzbz:"",zbianhao:0,weight:"",picture:[]}),d=e.ref([]),u=e.ref([]),l=e.ref([]),s=e=>{t.value.picture=String(e),console.log(String(t.value.picture))},r=a=>{console.log(a),a.value||e.index.showToast({title:"未找到该单元",icon:"none"}),t.value.qsid="",u.value=[],v()},c=e=>{},m=e.computed((()=>l.value.find((e=>e.id==t.value.xzbz))||"暂无")),p=()=>{e.index.showLoading(),o.value.validate().then((async a=>{let n={qyid:e.index.getStorageSync("user").qyid,unitid:t.value.dyid,qsid:t.value.qsid,standardid:m.value.standardname,standardcontent:m.value.standardcontent,picture:String(t.value.picture),operator:e.index.getStorageSync("user").name};await e.index.$post("/addyzgc",n),e.index.showToast({title:"操作成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3),e.index.hideLoading()})).catch((a=>{e.index.hideLoading(),console.log("表单错误信息：",a)}))},v=async()=>{let a={unitid:t.value.dyid};const n=await e.index.$post("/qslist",a);console.log("获取犬舍信息",n.data),u.value=n.data.map((e=>({value:e.id,text:e.enclosurename})))};e.onShow((()=>{(async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const n=await e.index.$post("/unitlist",a);d.value=n.data.map((e=>({value:e.id,text:e.unitname})))})(),(async()=>{const a={qyid:e.index.getStorageSync("user").qyid,type:"1",standardtype:1},n=await e.index.$post("/yzbz",a);l.value=n.data.map((e=>({...e,text:e.standardname,value:e.id}))),t.value.xzbz=l.value[0].id})()}));return(i,g)=>({a:e.o(r),b:e.o((e=>t.value.dyid=e)),c:e.p({localdata:d.value,placeholder:"请选择",modelValue:t.value.dyid}),d:e.p({rules:[{required:!0,errorMessage:"请选择所在单元"}],label:"所在单元:",name:"dyid",required:!0}),e:e.o(c),f:e.o((e=>t.value.qsid=e)),g:e.p({localdata:u.value,placeholder:"请选择",modelValue:t.value.qsid}),h:e.o((a=>{return n="quanshe",void e.index.scanCode({success:async function(e){let a=JSON.parse(e.result);a&&("quanshe"==n?(t.value.dyid=a.unitid,await v(),t.value.qsid=a.qsid,console.log("扫码圈舍",t.value.qsid)):"fudai"==n?t.value.fbianhao=a:"mudai"==n?t.value.mbianhao=a:"luzhi"==n&&(t.value.zbianhao=a))},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}});var n})),i:a._imports_0,j:e.p({rules:[{required:!0,errorMessage:"请选择所在圈舍"}],label:"所在圈舍:",name:"qsid",required:!0}),k:e.o((e=>t.value.xzbz=e)),l:e.p({mode:"tag",localdata:l.value,modelValue:t.value.xzbz}),m:e.t(e.unref(m).standardcontent||"暂无"),n:e.p({rules:[{required:!0,errorMessage:"请上传图片"}],label:"鹿只图片:",name:"picture",required:!0}),o:e.o(s),p:e.p({action:e.unref(n.uploadUrl)}),q:e.sr(o,"17e41c3c-0",{k:"form"}),r:e.p({modelValue:t.value,"label-width":"80px","label-align":"left"}),s:e.o(p)})}};wx.createPage(i);
