"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js");if(require("../../network/request.js"),require("../../config/global-config.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const l={__name:"fangyicjAdd",setup(l){const n=e.ref(),i=e.ref({name:e.index.getStorageSync("user").zname||"",dyid:"",qsid:"",lzid:"",lzbh:"",xzbz:"",zbianhao:0,yl:"",ywname:"",weight:"",picture:[]}),d=e.ref([]),u=e.ref([]),o=e.ref([]),t=e.ref([]),s=e.ref([]),r=a=>{console.log(a),a.value||e.index.showToast({title:"未找到该单元",icon:"none"}),i.value.qsid="",i.value.lzid="",i.value.lzbh="",t.value=[],q(),console.log("圈舍",i.value.qsid)},v=e=>{i.value.lzid="",i.value.lzbh="",u.value=[],g()},c=e=>{i.value.lzid=u.value.find((e=>e.text===i.value.lzbh)).id,console.log("选中的id",i.value.lzid)},m=e.computed((()=>s.value.find((e=>e.id==i.value.xzbz))||"暂无")),y=e=>{i.value.yl=d.value.find((e=>e.value==i.value.ywname)).dose||"暂无"},p=()=>{e.index.showLoading(),n.value.validate().then((async a=>{let l={qyid:e.index.getStorageSync("user").qyid,unitid:i.value.dyid,qsid:i.value.qsid,standardid:m.value.standardname,standardcontent:m.value.standardcontent,operator:e.index.getStorageSync("user").name,deernum:i.value.lzid,dosage:i.value.yl,sydrug:i.value.ywname};await e.index.$post("/addfygc",l),e.index.showToast({title:"操作成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3),e.index.hideLoading()})).catch((a=>{e.index.hideLoading(),console.log("表单错误信息：",a)}))},q=async()=>{let a={unitid:i.value.dyid};const l=await e.index.$post("/qslist",a);console.log("获取犬舍信息",l.data),t.value=l.data.map((e=>({value:e.id,text:e.enclosurename})))},g=async()=>{const a={qyid:e.index.getStorageSync("user").qyid,unitid:i.value.dyid,qsid:i.value.qsid,status:"1"},l=await e.index.$post("/lufiles",a);u.value=l.data.map((e=>({...e,text:e.deernum||e.id,value:e.deernum||e.id})))};e.computed((()=>d.value.find((e=>e.value==i.value.ywname))||"暂无")),e.onShow((()=>{(async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const l=await e.index.$post("/unitlist",a);o.value=l.data.map((e=>({value:e.id,text:e.unitname})))})(),(async()=>{const a={qyid:e.index.getStorageSync("user").qyid,type:"1",standardtype:2},l=await e.index.$post("/yzbz",a);s.value=l.data.map((e=>({...e,text:e.standardname,value:e.id}))),i.value.xzbz=s.value[0].id})(),(async()=>{const a={qyid:e.index.getStorageSync("user").qyid},l=await e.index.$post(`/syyw?qyid=${a.qyid}`,a);d.value=l.data.map((e=>({...e,text:e.name,value:e.name}))),i.value.ywname=d.value[0].value,i.value.yl=d.value.find((e=>e.value==i.value.ywname)).dose||"暂无"})()}));const x=a=>{if(!i.value.qsid&&"luzhi"==a)return e.index.showToast({title:"选择圈舍后再选编号",icon:"none"});e.index.scanCode({success:async function(e){let l=JSON.parse(e.result);l&&("quanshe"==a?(i.value.dyid=l.unitid,await q(),i.value.qsid=l.qsid,console.log("扫码圈舍",i.value.qsid)):"fudai"==a?i.value.fbianhao=l:"mudai"==a?i.value.mbianhao=l:"luzhi"==a&&(i.value.zbianhao=l))},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}})};return(l,q)=>({a:e.o(r),b:e.o((e=>i.value.dyid=e)),c:e.p({localdata:o.value,placeholder:"请选择",modelValue:i.value.dyid}),d:e.p({rules:[{required:!0,errorMessage:"请选择所在单元"}],label:"所在单元:",name:"dyid",required:!0}),e:e.o(v),f:e.o((e=>i.value.qsid=e)),g:e.p({localdata:t.value,placeholder:"请选择",modelValue:i.value.qsid}),h:e.o((e=>x("quanshe"))),i:a._imports_0,j:e.p({rules:[{required:!0,errorMessage:"请选择所在圈舍"}],label:"所在圈舍:",name:"qsid",required:!0}),k:e.o(c),l:e.o((e=>i.value.lzbh=e)),m:e.p({localdata:u.value,placeholder:"请选择",modelValue:i.value.lzbh}),n:e.o((e=>x("luzhi"))),o:a._imports_0,p:e.p({rules:[{required:!0,errorMessage:"请选择所在鹿只"}],label:"鹿只编号:",name:"qsid",required:!0}),q:e.o(y),r:e.o((e=>i.value.ywname=e)),s:e.p({localdata:d.value,placeholder:"请选择",modelValue:i.value.ywname}),t:e.p({rules:[{required:!0,errorMessage:"请选择使用药物"}],label:"使用药物:",name:"ywname",required:!0}),v:e.o((e=>i.value.yl=e)),w:e.p({type:"text",disabled:"",placeholder:"请输入用量",modelValue:i.value.yl}),x:e.p({label:"用量:",name:"yl",rules:[{required:!0,errorMessage:"请输入用量"}],required:!0}),y:e.o((e=>i.value.xzbz=e)),z:e.p({mode:"tag",localdata:s.value,modelValue:i.value.xzbz}),A:e.t(e.unref(m).standardcontent||"暂无"),B:e.sr(n,"2f27ab2a-0",{k:"form"}),C:e.p({modelValue:i.value,"label-width":"80px","label-align":"left"}),D:e.o(p)})}};wx.createPage(l);
