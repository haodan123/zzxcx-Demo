"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js");if(require("../../network/request.js"),require("../../config/global-config.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const l={__name:"lurongcjAdd",setup(l){const i=e.ref(),o=e.ref({name:e.index.getStorageSync("user").zname||"",zdbm:"",lzbh:"",lzid:"",lzbianhao:"",dyid:"",qsid:"",spdj:"",spmc:"",weight:"",picture:[]});e.ref(!1);const d=e.ref([]),u=e.ref([]),s=e.ref([]),n=e.ref([]),t=e=>{o.value.spdj=e.value,console.log(o.value.spdj)},r=a=>{console.log(a),a.value||e.index.showToast({title:"未找到该单元",icon:"none"}),o.value.qsid="",o.value.lzid="",o.value.lzbh="",s.value=[],v(),console.log(o.value.dyid)},c=e=>{console.log(o.value.qsid),o.value.lzid="",o.value.lzbh="",d.value=[],g()},p=e=>{o.value.lzid=d.value.find((e=>e.text===o.value.lzbh)).id,console.log("选中的id",o.value.lzid)},m=()=>{e.index.showLoading(),i.value.validate().then((async a=>{let l={qyid:e.index.getStorageSync("user").qyid,unitid:o.value.dyid,qsid:o.value.qsid,deernum:o.value.lzid,ribbonnum:o.value.zdbm,goodname:o.value.spmc,grade:o.value.spdj,weight:o.value.weight,operator:e.index.getStorageSync("user").name,picture:String(o.value.picture)};await e.index.$post("/addlrcj",l),e.index.showToast({title:"操作成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3),e.index.hideLoading()})).catch((a=>{e.index.hideLoading(),console.log("表单错误信息：",a)}))},v=async()=>{let a={unitid:o.value.dyid};const l=await e.index.$post("/qslist",a);console.log("获取犬舍信息",l.data),s.value=l.data.map((e=>({value:e.id,text:e.enclosurename})))},g=async()=>{const a={qyid:e.index.getStorageSync("user").qyid,unitid:o.value.dyid,qsid:o.value.qsid,status:"1"},l=await e.index.$post("/lufiles",a);d.value=l.data.map((e=>({...e,text:e.deernum||e.id,value:e.deernum||e.id})))};e.onShow((()=>{(async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const l=await e.index.$post("/unitlist",a);u.value=l.data.map((e=>({value:e.id,text:e.unitname})))})(),(async()=>{e.index.getStorageSync("user").qyid,o.value.dyid,o.value.qsid;const a=await e.index.$post("/dictType?dictType=piloseantler_status");n.value=a.data.map((e=>({text:e.dictLabel,value:e.dictValue})))})()}));const q=a=>{if(!o.value.qsid&&"luzhi"==a)return e.index.showToast({title:"选择圈舍后再选编号",icon:"none"});e.index.scanCode({success:async function(l){let i=JSON.parse(l.result);if(i)if("quanshe"==a)o.value.dyid=i.unitid,await v(),o.value.qsid=i.qsid,console.log("扫码圈舍",o.value.qsid);else if("zadai"==a)o.value.zdbm=i;else if("luzhi"==a){if(!o.value.qsid)return e.index.showToast({title:"选择圈舍后再选耳标"});o.value.lzbianhao=i}else"zhadai"===a&&(o.value.zdbm=i)},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}})};return(l,v)=>({a:e.o(r),b:e.o((e=>o.value.dyid=e)),c:e.p({localdata:u.value,placeholder:"请选择",modelValue:o.value.dyid}),d:e.p({rules:[{required:!0,errorMessage:"请选择所在单元"}],label:"所在单元:",name:"dyid",required:!0}),e:e.o(c),f:e.o((e=>o.value.qsid=e)),g:e.p({localdata:s.value,placeholder:"请选择",modelValue:o.value.qsid}),h:e.o((e=>q("quanshe"))),i:a._imports_0,j:e.p({rules:[{required:!0,errorMessage:"请选择所在圈舍"}],label:"所在圈舍:",name:"qsid",required:!0}),k:e.o(p),l:e.o((e=>o.value.lzbh=e)),m:e.p({localdata:d.value,placeholder:"请选择",modelValue:o.value.lzbh}),n:e.o((e=>q("luzhi"))),o:a._imports_0,p:e.p({rules:[{required:!0,errorMessage:"请选择所在鹿只"}],label:"鹿只编号:",name:"qsid",required:!0}),q:e.o((e=>o.value.zdbm=e)),r:e.p({type:"text",placeholder:"请输入扎带编码",modelValue:o.value.zdbm}),s:e.o((e=>q("zhadai"))),t:a._imports_0,v:e.p({rules:[{required:!0,errorMessage:"请输入扎带编码"}],label:"扎带编码:",name:"zdbm",required:!0}),w:e.o((e=>o.value.spmc=e)),x:e.p({type:"text",placeholder:"请输入商品名称",modelValue:o.value.spmc}),y:e.p({rules:[{required:!0,errorMessage:"请输入商品名称"}],label:"商品名称:",name:"spmc",required:!0}),z:e.o(t),A:e.o((e=>o.value.spdj=e)),B:e.p({localdata:n.value,placeholder:"请选择",modelValue:o.value.spdj}),C:e.p({rules:[{required:!0,errorMessage:"请选择商品等级"}],label:"商品等级:",name:"spdj",required:!0}),D:e.o((e=>o.value.weight=e)),E:e.p({type:"text",placeholder:"请输入重量,单位kg",modelValue:o.value.weight}),F:e.p({rules:[{required:!0,errorMessage:"请输入重量"}],label:"重量:",name:"weight",required:!0}),G:e.sr(i,"6d57bf18-0",{k:"form"}),H:e.p({modelValue:o.value,"label-width":"90px","label-align":"left"}),I:e.o(m)})}};wx.createPage(l);
