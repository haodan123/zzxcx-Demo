"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js");if(require("../../network/request.js"),require("../../config/global-config.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const o={__name:"zhonglucjAdd",setup(o){const l=e.ref(),i=e.ref({name:e.index.getStorageSync("user").zname||"",lzbh:"",dyid:"",qsid:"",sex:"",weight:"",lid:"",fbianhao:"",mbianhao:"",pinzhong:"",picture:[]}),n=e.ref(!1),u=e.ref([]),s=e.ref([]),d=e.ref([]),t=a=>{console.log(a),a.value||e.index.showToast({title:"未找到该单元",icon:"none"}),i.value.qsid="",i.value.lzid="",i.value.lzbh="",d.value=[],c(),console.log(i.value.lid)},r=e=>{i.value.lzid="",i.value.lzbh="",i.value.pinzhong="",i.value.fbianhao="",i.value.mbianhao="",u.value=[],console.log(i.value.lid),h()},m=()=>{const e=u.value.find((e=>e.id===i.value.lzbh));console.log(e),i.value.pinzhong=e.variety,i.value.fbianhao=e.fnumber,i.value.mbianhao=e.mnumber,console.log(i.value)},v=()=>{e.index.showLoading(),l.value.validate().then((async a=>{let o={zid:e.index.getStorageSync("user").qyid,zbianhao:i.value.lzbh,unitid:i.value.dyid,qsid:i.value.qsid,pinzhong:i.value.pinzhong,fbianhao:i.value.fbianhao,mbianhao:i.value.mbianhao,status:"1",faburen:e.index.getStorageSync("user").name};await e.index.$post("/addzlpd",o),e.index.showToast({title:"操作成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3),e.index.hideLoading()})).catch((a=>{e.index.hideLoading(),console.log("表单错误信息：",a)}))},c=async()=>{let a={unitid:i.value.dyid};const o=await e.index.$post("/qslists",a);console.log("获取犬舍信息",o.data),d.value=o.data.map((e=>({value:e.id,text:e.enclosurename})))},h=async()=>{const a={qyid:e.index.getStorageSync("user").qyid,jsid:i.value.qsid,status:"1"},o=await e.index.$post("/rljd",a);u.value=o.data.map((e=>({...e,text:e.number||e.id,value:e.id})))};e.onLoad((({item:e})=>{if(e){n.value=!0;const a=JSON.parse(e);console.log("更新",n.value,a)}})),e.onShow((()=>{(async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const o=await e.index.$post("/unitlist",a);s.value=o.data.map((e=>({value:e.id,text:e.unitname})))})()}));const p=a=>{if(!i.value.qsid&&"luzhi"==a)return e.index.showToast({title:"选择圈舍后再选编号",icon:"none"});e.index.scanCode({success:async function(e){let o=JSON.parse(e.result);console.log(o),o&&("quanshe"==a?(i.value.dyid=o.unitid,await c(),i.value.qsid=o.qsid,console.log("扫码圈舍",i.value.qsid)):"fudai"==a?i.value.fbianhao=o:"mudai"==a?i.value.mbianhao=o:"luzhi"==a&&(i.value.lzbh=o))},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}})};return(o,n)=>({a:e.o(t),b:e.o((e=>i.value.dyid=e)),c:e.p({localdata:s.value,placeholder:"请选择",modelValue:i.value.dyid}),d:e.p({rules:[{required:!0,errorMessage:"请选择所在单元"}],label:"所在单元:",name:"dyid",required:!0}),e:e.o(r),f:e.o((e=>i.value.qsid=e)),g:e.p({localdata:d.value,placeholder:"请选择",modelValue:i.value.qsid}),h:e.o((e=>p("quanshe"))),i:a._imports_0,j:e.p({rules:[{required:!0,errorMessage:"请选择所在圈舍"}],label:"所在圈舍:",name:"qsid",required:!0}),k:e.o(m),l:e.o((e=>i.value.lzbh=e)),m:e.p({localdata:u.value,placeholder:"请选择",modelValue:i.value.lzbh}),n:e.o((e=>p("luzhi"))),o:a._imports_0,p:e.p({rules:[{required:!0,errorMessage:"请选择所在鹿只"}],label:"鹿只编号:",name:"qsid",required:!0}),q:e.o((e=>i.value.pinzhong=e)),r:e.p({type:"text",disabled:"",placeholder:"选择编号后获取品种",modelValue:i.value.pinzhong}),s:e.p({rules:[{required:!0,errorMessage:"请输入鹿只品种"}],label:"鹿只品种:",name:"pinzhong",required:!0}),t:e.o((e=>i.value.fbianhao=e)),v:e.p({type:"text",placeholder:"选择编号后获取父代编号",disabled:"",modelValue:i.value.fbianhao}),w:e.p({label:"父代编号:",name:"fbianhao"}),x:e.o((e=>i.value.mbianhao=e)),y:e.p({type:"text",placeholder:"选择编号后获取母代编号",disabled:"",modelValue:i.value.mbianhao}),z:e.p({label:"母代编号:",name:"mbianhao"}),A:e.sr(l,"6e0ed0e0-0",{k:"form"}),B:e.p({modelValue:i.value,"label-width":"80px","label-align":"left"}),C:e.o(v)})}};wx.createPage(o);
