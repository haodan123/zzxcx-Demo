"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js");if(require("../../network/request.js"),require("../../config/global-config.js"),!Array){(e.resolveComponent("uani-datapicker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../components/uani-datapicker/uani-datapicker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const i={__name:"chushengxlAdd",setup(i){const o=e.ref(),l=e.ref({name:e.index.getStorageSync("user").zname||"",lzbh:"",dyid:"",qsid:"",sex:"",weight:"",addtime:"",lid:"",fbianhao:"",mbianhao:"",pinzhong:"",picture:[]}),n=e.ref(!1),u=e.ref([]),d=e.ref([]),t=e.ref([]),s=a=>{console.log(a),a.value||e.index.showToast({title:"未找到该单元",icon:"none"}),l.value.qsid="",l.value.lzid="",l.value.lzbh="",d.value=[],v(),console.log(l.value.lid)},r=e=>{l.value.lzid="",l.value.lzbh="",l.value.pinzhong="",l.value.fbianhao="",l.value.mbianhao="",t.value=[],console.log(l.value.lid),p()},m=()=>{const e=t.value.find((e=>e.id===l.value.lzbh));console.log(e),l.value.pinzhong=e.variety,l.value.fbianhao=e.fnumber,l.value.mbianhao=e.mnumber,console.log(l.value)},c=()=>{e.index.showLoading(),o.value.validate().then((async a=>{let i={zid:e.index.getStorageSync("user").qyid,zbianhao:l.value.lzbh,unitid:l.value.dyid,qsid:l.value.qsid,pinzhong:l.value.pinzhong,fbianhao:l.value.fbianhao,mbianhao:l.value.mbianhao,status:"1",caddtime:l.value.addtime,person:e.index.getStorageSync("user").name};await e.index.$post("/addcsxl",i),e.index.showToast({title:"操作成功"}),setTimeout((()=>{e.index.navigateBack()}),1e3),e.index.hideLoading()})).catch((a=>{e.index.hideLoading(),console.log("表单错误信息：",a)}))},v=async()=>{let a={unitid:l.value.dyid};const i=await e.index.$post("/qslists",a);console.log("获取犬舍信息",i.data),d.value=i.data.map((e=>({value:e.id,text:e.enclosurename})))},p=async()=>{const a={qyid:e.index.getStorageSync("user").qyid,jsid:l.value.qsid,status:"1"},i=await e.index.$post("/rljd",a);t.value=i.data.map((e=>({...e,text:e.number||e.id,value:e.id})))};e.onLoad((({item:e})=>{if(e){n.value=!0;const a=JSON.parse(e);console.log("更新",n.value,a)}})),e.onShow((()=>{(async()=>{let a={qyid:e.index.getStorageSync("user").qyid};const i=await e.index.$post("/unitlist",a);u.value=i.data.map((e=>({value:e.id,text:e.unitname})))})()}));const h=a=>{if(!l.value.qsid&&"luzhi"==a)return e.index.showToast({title:"选择圈舍后再选编号",icon:"none"});e.index.scanCode({success:async function(e){let i=JSON.parse(e.result);console.log(i),i&&("quanshe"==a?(l.value.dyid=i.unitid,await v(),l.value.qsid=i.qsid,console.log("扫码圈舍",l.value.qsid)):"fudai"==a?l.value.fbianhao=i:"mudai"==a?l.value.mbianhao=i:"luzhi"==a&&(l.value.lzbh=i))},fail:function(a){console.log(a),e.index.showToast({title:"请扫描正确的二维码！",icon:"none",duration:2e3})}})};return(i,n)=>({a:e.o(s),b:e.o((e=>l.value.dyid=e)),c:e.p({localdata:u.value,placeholder:"请选择",modelValue:l.value.dyid}),d:e.p({rules:[{required:!0,errorMessage:"请选择所在单元"}],label:"所在单元:",name:"dyid",required:!0}),e:e.o(r),f:e.o((e=>l.value.qsid=e)),g:e.p({localdata:d.value,placeholder:"请选择",modelValue:l.value.qsid}),h:e.o((e=>h("quanshe"))),i:a._imports_0,j:e.p({rules:[{required:!0,errorMessage:"请选择所在圈舍"}],label:"所在圈舍:",name:"qsid",required:!0}),k:e.o(m),l:e.o((e=>l.value.lzbh=e)),m:e.p({localdata:t.value,placeholder:"请选择",modelValue:l.value.lzbh}),n:e.o((e=>h("luzhi"))),o:a._imports_0,p:e.p({rules:[{required:!0,errorMessage:"请选择所在鹿只"}],label:"鹿只编号:",name:"qsid",required:!0}),q:e.o((e=>l.value.pinzhong=e)),r:e.p({type:"text",disabled:!0,placeholder:"请输入鹿只品种",modelValue:l.value.pinzhong}),s:e.p({rules:[{required:!0,errorMessage:"请输入鹿只品种"}],label:"鹿只品种:",name:"pinzhong",required:!0}),t:e.o((e=>l.value.fbianhao=e)),v:e.p({type:"text",placeholder:"扫描鹿只编号获取父代编号",disabled:"",modelValue:l.value.fbianhao}),w:e.p({label:"父代编号:",name:"fbianhao"}),x:e.o((e=>l.value.mbianhao=e)),y:e.p({type:"text",placeholder:"扫描鹿只编号获取母代编号",disabled:"",modelValue:l.value.mbianhao}),z:e.p({label:"母代编号:",name:"mbianhao"}),A:e.o(i.changTime),B:e.o((e=>l.value.addtime=e)),C:e.p({type:"datetime",returnType:"date","clear-icon":!1,modelValue:l.value.addtime}),D:e.p({label:"初生日期:",rules:[{required:!0,errorMessage:"请选择初生日期"}],required:!0,name:"addtime"}),E:e.sr(o,"35bbc5aa-0",{k:"form"}),F:e.p({modelValue:l.value,"label-width":"80px","label-align":"left"}),G:e.o(c)})}};wx.createPage(i);
