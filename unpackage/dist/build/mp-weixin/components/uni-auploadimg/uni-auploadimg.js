"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const i={__name:"uni-auploadimg",props:{fileLists:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},action:{type:String,default:""},minsize:{type:Number,default:1},maxsize:{type:Number,default:9},uptype:{type:Array,default:()=>["image"]}},emits:["onChange"],setup(i,{emit:o}){const l=i;e.onLoad((()=>{}));const n=e.ref(null),t=e.ref(l.fileLists),u=e.ref(null),a=()=>{r()},p=()=>{n.value.open()},s=()=>{n.value.close()},d=()=>{null!=u.value&&t.value.splice(u.value,1),u.value=null,o("onChange",t.value),n.value.close()},r=()=>{e.index.chooseMedia({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],mediaType:l.uptype,success:function(e){console.log(e),"video"==e.tempFiles[0].fileType?c("video",e.tempFiles[0].tempFilePath,e.tempFiles[0].thumbTempFilePath):c("image",e.tempFiles[0].tempFilePath)}})},c=(i,n,u)=>{e.index.showLoading({title:"文件上传中"}),e.index.uploadFile({url:l.action,filePath:n,name:"file",success:n=>{let a=JSON.parse(n.data);if(console.log(a),"200"==a.code){if(e.index.showToast({title:"上传成功"}),"video"==i){let n=null;n=a.url,e.index.uploadFile({url:l.action,filePath:u,name:"file",success:l=>{let u=JSON.parse(l.data);"200"==u.code?(e.index.showToast({title:"上传成功"}),t.value.push({url:n,preimg:u.url,type:i}),o("onChange",t.value)):e.index.showToast({icon:"none",title:"网络异常，稍后再试"}),e.index.hideLoading()},fail:i=>{e.index.hideLoading()}})}else a.url.startsWith("http://")&&(console.log("http开头"),a.url=a.url.replace("http://","https://")),t.value.push(a.url);o("onChange",t.value)}else e.index.showToast({icon:"none",title:"网络异常，稍后再试"});e.index.hideLoading()},fail:i=>{e.index.hideLoading()}})};return(o,l)=>e.e({a:e.f(t.value,((i,o,l)=>({a:i,b:e.o((i=>(i=>{e.wx$1.previewMedia({sources:t.value,current:i,url:t.value[i]})})(o)),o),c:e.o((e=>(e=>{u.value=e,p()})(o)),o),d:"d5e29ec8-0-"+l,e:o}))),b:e.p({type:"minus-filled",size:"25",color:"red"}),c:t.value.length<i.maxsize},t.value.length<i.maxsize?{d:e.p({type:"plusempty",size:"30",color:"#7a7a7a"}),e:e.o(a)}:{},{f:e.o(s),g:e.o(d),h:e.p({content:"确定删除此项吗"}),i:e.sr(n,"d5e29ec8-2",{k:"popup"}),j:e.p({type:"dialog"})})}};wx.createComponent(i);
